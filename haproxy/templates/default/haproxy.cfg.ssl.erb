<%
if @ssl_enabled == 'off'
  return
end
-%>
  bind *:443 ssl crt <%= @certificate %>
  reqadd X-Forwarded-Proto:\ https if { ssl_fc }
<% unless @hsts.nil? -%>
  rspadd Strict-Transport-Security:\ max-age=<%=@hsts%> if { ssl_fc }
<% end
if @ssl_enabled == 'only' -%>

  # is_letsencrpyt acl needs to come before this redirect
  acl is_letsencrypt path_beg -i /.well-known/acme-challenge/
  redirect scheme https if !{ ssl_fc } !is_letsencrypt
<% end -%>
